clear all;
%设定参数
D1=3;
D2=4;
D3=5;
a3=0.05+D1/200;
b3=0.05+D2/200;
c3=0.1+D3/200;
%样本数据
X=[2800 2971 2940 2885  2885 2852 2863 2887  2945  2905;
   900 776 729 704 686 668 656 661 665 671;
   220 257 275 283 287 289 292 294 294 297];
U=[1273 1142 1106 1110 1125 1138 1156 1200 1125;
   100 101 102 100 94 91 101 101 100;
   42 41 39 38 38 41 41 40 42];
B=zeros(1,7);
A=zeros(7,7);
for i=2:1:10;
    Btmp=[X(1,i)-(1-a3)*X(1,i-1)-U(1,i-1);
       X(2,i)-(1-b3)*X(2,i-1)-U(2,i-1);
       X(3,i)-(1-c3)*X(3,i-1)-U(3,i-1)];
    Atmp=-1*[-X(1,i) -X(1,i) 0 X(2,i) 0 0 0;
         X(1,i) 0 -X(2,i) -X(2,i) -X(2,i) 0 X(3,i);
         0 0 X(2,i) 0 0 -X(3,i) -X(3,i)];
     B=B+Btmp'*Atmp;
     A=A+Atmp'*Atmp;
end;
R=quadprog(A,B,[],[],[],[],[0 0 0 0 0 0 0]',[1 1 1 1 1 1 1]');
R'
%模型预测
Num=[X(1,1);X(2,1);X(3,1);];
for i=2:1:10
    Bpre=[(1-a3)*Num(1,i-1)+U(1,i-1);
        (1-b3)*Num(2,i-1)+U(2,i-1);
        (1-c3)*Num(3,i-1)+U(3,i-1)];
    Apre=-1*[X(1,i) X(1,i) 0 -X(2,i) 0 0 0;
         -X(1,i) 0 X(2,i) X(2,i) X(2,i) 0 -X(3,i);
         0 0 -X(2,i) 0 0 X(3,i) X(3,i)];
    Num =[Num,Bpre+Apre*R];
end
Num'

%分析预测结果
titles={'B.Sc.' 'M.Sc.' 'Ph.D.'};
for i=1:1:3
    subplot(2,2,i);
    X_=2:1:10;
    plot(X_,X(i,X_));
    hold
    plot(X_,Num(i,X_));
    legend(titles(1,i));
end
% 限定新入学人数
a1=R(1,1);
a2=R(2,1);
b1=R(3,1);
b2=R(4,1);
b4=R(5,1);
c2=R(6,1);
c4=R(7,1);
Con=[2500;600;200];
D=[1-a1-a2-a3 b4 0;a1 1-b1-b2-b3-b4 c4;0 b1 1-c2-c3-c4];
A1=-1*([[1 0 0;0 1 0;0 0 1] zeros(3,3)]);
b1=-(Con-D*X(:,10));
A2=-1*([D [0 0 0;0 0 0;0 0 0]]+[zeros(3,3) [1 0 0;0 1 0;0 0 1]]);
b2=-(Con-D*D*X(:,10));
y=linprog(ones(1,6),[A1;A2],[b1;b2],[],[],zeros(6,1),[]);
y'
